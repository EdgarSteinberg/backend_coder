<div class="containerHome">
    <h1>Bienvenido {{user.first_name}} {{user.username}} </h1>
    <a class="logout-link" href="/">Inicio</a>
    <a class="logout-link" href="/products">Productos</a>
    <a class="logout-link" href="/carts/{{cart._id}}">Carrito</a>
    <a class="logout-link" href="/chat">chat</a>
    <a class="logout-link" href="/uploadDocuments">Carga tus documentos</a>
    <a class="logout-link" href="/realTimeProducts">Carga tus productos</a>
    <a class="logout-link" href="/admUsers">Roles</a>
    <form method="post" action="/api/users/logout">
        <button class="logout-link" type="submit">Cerrar Session</button>
    </form>
</div>
<hr>
<div >
<h1>Administrar Usuarios</h1>
<div class="box">
    <table class="border">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Acciones</th>
            </tr>
        </thead>

        {{#each users}}
        <tr>
            <td>{{this._id}}</td>
            <td>{{this.first_name}}</td>
            <td>{{this.email}}</td>
            <td>{{this.role}}</td>
            <td>
                <button class="btnSucces" onclick="changeRole('{{this._id}}', 'premium')">Convertir a Premium</button>
                <button class="btnUser" onclick="changeRole('{{this._id}}', 'user')">Convertir a Usuario</button>
                <button class="btnDelete" onclick="deleteUser('{{this._id}}')">Eliminar Usuario</button>
            </td>
        </tr>
        {{/each}}

    </table>
</div>

<style>
    .btnSucces {
        background-color: green;
        font-weight: bolder;
        color: white;
    }

    .btnSucces:hover {
        background-color: rgb(12, 199, 12);
        font-weight: bolder;
        color: white;
    }

    .btnDelete {
        background-color: rgb(153, 0, 0);
        font-weight: bolder;
        color: white;
    }

    .btnDelete:hover {
        background-color: rgb(252, 0, 0);
        font-weight: bolder;
        color: white;
    }

    .btnUser {
        background-color: #b7d110;
        font-weight: bolder;
        color: white;
    }

    .btnUser:hover {
        background-color: #ddff03;
        font-weight: bolder;
        color: rgb(255, 255, 255);
    }

    button {
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 7px;
    }

    .border th,
    .border td {
        border: 1px solid rgb(255, 255, 255);
        /* Agrega un borde a todas las celdas */
        padding: 8px;
        /* Opcional, para espaciado dentro de las celdas */
        background-color: #1C1F30;
    }
</style>

<script>
    function changeRole(userId, newRole) {
        fetch(`/api/users/premium/${userId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ role: newRole }),
        })
            .then(response => {
                if (response.ok) {
                    alert('Rol actualizado con éxito.');
                    window.location.reload(); // Recargar la página para ver los cambios
                } else {
                    return response.json().then(data => {
                        alert(`Error: ${data.error}`);
                    });
                }
            })
            .catch(error => {
                console.error('Error al actualizar el rol:', error);
                alert('Error al actualizar el rol.');
            });
    }

    function deleteUser(userId) {
        fetch(`/api/users/${userId}`, {
            method: 'DELETE',
        })
            .then(res => {
                if (res.ok) {
                    alert('Usuario Eliminado.');
                    window.location.reload();
                } else {
                    return res.json().then(data => {
                        alert(`Error: ${data.error || 'No se pudo eliminar el usuario.'}`);
                    });
                }
            })
            .catch(error => {
                console.error('Error al eliminar el usuario:', error);
                alert('Error al eliminar el usuario.');
            })
    }
</script>